<!doctype html><meta charset=utf-8><title>SocialGraph</title><style>body{font-family:'Helvetica Neue',Helvetica,Verdana,Arial}a{color:#369;text-decoration:none}canvas,nav{display:block;position:fixed;left:0;top:0}canvas{width:100%;height:100%}#panel{display:block;position:fixed;width:50%;max-width:600px;left:25%;max-height:80%;top:10%;overflow-y:scroll;background:#fff;padding:10px;box-shadow:0 5px 5px rgba(0,0,0,.4);border:1px #bbb solid}.right,nav button,#Close{float:right}nav{right:0;padding:2px 5px}button{border:1px #ddd solid;border-bottom-color:#bbb;background-color:#f5f5f5;background-image:linear-gradient(transparent,rgba(0,0,0,.2));padding:3px 9px;border-radius:3px;font-size:12px;font-weight:600;color:#666;text-shadow:0 1px 0 #fff;box-shadow:0 1px 0 #fff;margin:0 1px}button:hover{background-image:linear-gradient(transparent,rgba(0,0,0,.3));color:#222}button:hover,#meta{cursor:pointer}#New,#New:hover{background-color:#8add6d;border-color:#74bb5a #74bb5a #509438;text-shadow:0 1px 0 #666;color:#fff}#Close{color:#f00}label{display:inline-block;clear:left;width:20%;min-width:120px}input,select{font-size:inherit;margin:1px}input{width:70%}textarea{width:100%;min-height:200px}</style><script>function d(a,b){this.x=a;this.y=b;this.a=function(a){return e(this.x+a.x,this.y+a.y)};this.c=function(a){return e(this.x-a.x,this.y-a.y)};this.b=function(a){return e(this.x*a,this.y*a)};this.g=function(a){return this.x*a.x+this.y*a.y};this.f=function(){return Math.sqrt(this.g(this))};this.e=function(a){return this.c(a).f()};return this}function e(a,b){return new d(a,b)};var f="223,87,69 40,207,174 99,129,208 138,219,76 205,167,31 211,81,177 93,161,72".split(" "),k=["Organization","People","Project"];function l(a){if(!a.members||!(a.members instanceof Array))a.members=[];a.position||(a.position=e((Math.random()-0.5)*m.width,(Math.random()-0.5)*m.height));if(!a.color||"string"!==typeof a.color)a.color=f[Math.round(Math.random()*f.length)];this.title=a.title;this.type=a.type;this.h=a.h;this.description=a.description;this.j=a.j;this.mass=1+a.members.length;this.radius=20*Math.sqrt(this.mass);this.position=a.position;this.links=a.links;this.members=a.members;this.color=a.color;this.b=function(a){return this.position.e(a.position)};this.c=function(){for(var a=e(0,0),c=0,h=n.vertices.length;c<h;c++){var g=new l(n.vertices[c]);if(g.title!=this.title)var j=g.b(this)/(this.radius+g.radius+180),a=a.a(g.position.c(this.position).b((j-1)/(j*j)/g.b(this)))}return a=a.a(this.position.b(-0.0020*this.mass))};this.e=function(){this.position=this.position.a(this.c().b(1));return this};this.f=function(a){var c=this.position.a(m.d),h=a?1:0.6,g=this.radius,j=Math.ceil(2.5*Math.sqrt(g));m.beginPath();m.lineWidth=a?3:1;m.fillStyle="rgba("+this.color+ ","+h/2+")";m.strokeStyle="rgba("+this.color+","+h+")";this.type==k[0]?m.arc(c.x,c.y,g,0,6.283185):this.type==k[1]?this.a([c.a(e(-g,-g)),c.a(e(g,-g)),c.a(e(g,g)),c.a(e(-g,g))]):this.a([c.a(e(-g,0)),c.a(e(0,-g)),c.a(e(g,0)),c.a(e(0,g))]);m.closePath();m.stroke();m.fill();m.fillStyle="#000";m.font="600 "+j+"px Helvetica";m.textAlign="center";m.fillText(this.title,c.x,c.y+j/4);return this};this.g=function(a,c){var h=this.position.a(m.d),g=a.position.a(m.d),j=g.c(h),x=h.e(g),h=j.b(this.radius/x).a(h), g=j.b(-1*a.radius/x).a(g),O=e(j.x-j.y,j.y+j.x).b(-7.5/x).a(g),j=e(j.x+j.y,j.y-j.x).b(-7.5/x).a(g);m.beginPath();m.lineWidth=c?3:1;m.strokeStyle="rgba("+this.color+",.8)";this.a([h,g,O]).a([g,j]);m.stroke()};this.a=function(a){for(var c=0,h=a.length;c<h;c++)0==c?m.moveTo(a[c].x,a[c].y):m.lineTo(a[c].x,a[c].y);return this};return this}function p(a){for(var b=0,c=n.vertices.length;b<c;b++)if(n.vertices[b].title==a)return b;return-1};var q=window.navigator.userAgent,q=window.opera?"Opera":-1!=q.indexOf("Chrome")?"Chrome":-1!=q.indexOf("Firefox")?"Firefox":"the browser",r=[{id:"GNU-GPL",name:"GNU General Public License",url:"//www.gnu.org/licenses/gpl.html"},{id:"GNU-FDL",name:"GNU Free Documentation License",url:"//www.gnu.org/licenses/fdl.html"},{id:"CC-BY-SA",name:"Creative Commons Attribution and Share-alike License",url:"//creativecommons.org/licenses/by-sa/3.0/"},{id:"CC-BY",name:"Creative Commons Attribution",url:"//creativecommons.org/licenses/by/3.0/"}, {id:"CC-BY-NC-SA",name:"Creative Commons Attribution, Non-commercial and Share-alike",url:"//creativecommons.org/licenses/by-nc-sa/3.0/"},{id:"CC-BY-NC-ND",name:"Creative Commons Attribution, Non-commercial and No-derivatives",url:"//creativecommons.org/licenses/by-nc-nd/3.0/"},{id:"CC-0",name:"Creative Commons Public Domain Dedication",url:"//creativecommons.org/licenses/../publicdomain/zero/1.0/"},{id:"COPYRIGHT",name:"Copyright "+(new Date).getFullYear()+". All right reserved",url:"//en.wikipedia.org/wiki/Copyright"}, {id:"WTFPL",name:"Do What The Fuck You Want License",url:"http://www.wtfpl.net/about/"}],s={"private":"me (with the password)","protected":"those who have the link","public":"everyone (public)"},t=document.location.protocol+"//socialgraph.boudah.pl/";function u(){var a=v("menu")?v("menu"):w("nav","menu"),b;a:{b=n.metadata.license;for(var c=0,h=r.length;c<h;c++)if(r[c].id==b){b='<a href="'+r[c].url+'" target=_blank title="'+r[c].name+'" rel=license>'+b+"</a>";break a}b=""}a.innerHTML=y("strong",n.metadata.title,"meta")+" by <em>"+n.metadata.authors.join()+"</em> ("+b+")"+z("Help")+z("Share")+z("Import")+z("Save")+z("New");document.title=n.metadata.title+" | SocialGraph";v("New").onclick=A;v("Save").onclick=B;v("Import").onclick=C;v("Share").onclick=D;v("Help").onclick=E;v("meta").onclick=F}function F(){for(var a={},b=0,c=r.length;b<c;b++)a[r[b].id]=r[b].name;G("Edit graph options",'<label for=graphTitle>Graph title:</label> <input type=text maxlength=30 id=graphTitle value="'+n.metadata.title+'"><br><label for=graphAuthors>Authors:</label> <input type=text maxlength=100 id=graphAuthors value="'+n.metadata.authors.join(", ")+'"><br><label for=graphVisibility>Visible to:</label> '+H("graphVisibility",s,n.metadata.visibility)+"<br><label for=graphLicense>Publish under:</label> "+H("graphLicense", a,n.metadata.license)+"<br>Graph created "+(new Date(n.metadata.created)).toLocaleString());v("graphTitle").onchange=I;v("graphAuthors").onchange=I;v("graphVisibility").onchange=I;v("graphLicense").onchange=I}function I(){n.metadata.title=v("graphTitle").value;n.metadata.visibility=v("graphVisibility").value;n.metadata.license=v("graphLicense").value;n.metadata.authors=v("graphAuthors").value.split(",").map(function(a){return a.replace(/(^\s+|\s+$)/g,"").replace(/\s+/g," ")});u()}function G(a,b){v("panel")||w("section","panel");v("panel").innerHTML=z("Close")+"<h1>"+a+"</h1>"+b;v("Close").onclick=J;document.body.style.backgroundColor="#ddd"}function J(){var a=v("panel");a&&document.body.removeChild(a);document.body.style.backgroundColor="#fff"}function A(){for(var a=1;-1!=p("#"+a);){if(99<a)return;a++}n.vertices.push(new l({title:"#"+a,type:k[0],position:m.i}));K=[n.vertices.length-1];L()}function B(){G("Save this graph",z("saveOffline","Save in "+q)+"<hr>"+z("saveOnline","Save on the web")+"<br>"+t+'?<input id=graphAlias value="'+M(n.metadata.alias)+'" maxlength=120><br>with the password <input type=password id=graphPass value=""> and visible to '+H("graphVisibility",s,n.metadata.visibility)+".<hr>"+z("Download")+" the "+H("exportData",["Graph","Contacts"])+" in the "+H("exportFormat",["JSON","Atom"])+" format.");N(n.metadata.alias);v("graphAlias").onchange=function(){N(v("graphAlias").value)};v("Download").onclick=P;v("saveOffline").onclick=Q;v("saveOnline").onclick=R}function N(a){S(t+"getAlias?"+M(a),function(a){v("graphAlias").value=n.metadata.alias=a})}function M(a){return a.replace(/\W+/g," ").replace(/(^\s+|\s+$)/g,"").replace(/ /g,"_").toLowerCase()}function C(){G("Import from","(Coming soon)")}function L(){if(0!=K.length){var a=n.vertices[K[0]];G("Edit this element","<label for=vertexType>Type:</label> "+H("vertexType",k,a.type)+'<br><label for=vertexTitle>Title:</label> <input type=text maxlength=30 id=vertexTitle value="'+a.title+'"><br><label for=vertexDescription>Description:</label> <input type=text maxlength=100 id=vertexDescription value="'+a.description+'"><label for=vertexImage>Image:</label> <input type=text maxlength=100 id=vertexImage value="'+(a.h?a.h.src:"")+'">');v("vertexType").onchange=T;v("vertexTitle").onchange=T;v("vertexDescription").onchange=T}}function T(){var a=K[0];n.vertices[a].type=v("vertexType").value;n.vertices[a].title=v("vertexTitle").value;n.vertices[a].description=v("vertexDescription").value;L()}function Q(){U("Not implemented yet !")}function R(){G("Saving graph on the world wild web...","");S(t+"save?"+n.metadata.visibility+"/"+n.metadata.alias,function(a){(a=window.JSON.parse(a))?a.url?window.location=a.url:U(a.status):U("Server responded in a unknown language!")},"json_content="+escape(window.JSON.stringify(n)))}function U(a){G("Argh!","An error happened, because "+a)}function E(){G("Help",'<p>SocialGraph aims to better understand a social network showing an intuitive dynamics of individuals and organizations that make up a network. It creates human-readable dynamics graph that you can export everywhere, and even use offline (just by saving this webpage on your computer).</p><ul><li><a href="//github.com/talenka/socialgraph/wiki/getting-started" target=_blank>Getting started</a></li></ul><p>This is a brand new project, if you are interested, join us on <a href="//github.com/talenka/socialgraph/" target=_blank>github</a>, where comments and <a href="//github.com/talenka/socialgraph/issues" target=_blank>bugs reports</a> are welcomed.</p>')}function D(){G("Share this graph","<p>Coming soon...</p><ul><li>Twitter</li><li>Facebook</li><li>Google+</li><li>Pinterest</li></ul>")}function V(){m.clearRect(0,0,m.width,m.height);for(var a=0,b=n.vertices.length;a<b;a++){var c=-1!==K.indexOf(a);n.vertices[a]=(new l(n.vertices[a])).e().f(c);for(var h in n.vertices[a].links)n.vertices[a].g(new l(n.vertices[p(h)]),c)}setTimeout(V,1)}function W(){var a=window.innerHeight,b=window.innerWidth;if(m.width!=b||m.height!=a){var c=v("canvas");c.width=b;c.height=a;m.width=b;m.height=a;m.d=e(b/2,a/2)}window.setTimeout(W,1E3)}function X(){var a;a:{a=m.i;for(var b=0,c=n.vertices.length;b<c;b++){var h=new l(n.vertices[b]);if(a.c(h.position).f()<h.radius){a=b;break a}}a=-1}0>a?(J(),K=[]):K=[a]};function P(){var a=v("exportFormat").value,b="";if("Graph"==v("exportData").value)if("JSON"==a)b=window.JSON.stringify(n);else if("Atom"==a){for(var b='<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom">'+y("title",n.metadata.title)+y("subtitle","A social graph")+'<link href="'+t+'"/>'+y("updated",n.metadata.created)+y("author",y("name",n.metadata.authors[0])),a=0,c=n.vertices.length;a<c;a++)b+=y("entry",y("title",n.vertices[a].title)+'<link href="'+t+'"/>'+y("updated", n.metadata.created)+y("summary",n.vertices[a].description));b+="</feed>"}""==b?U("this function is not yet implemented :-("):G("Output",y("textarea",b))}function S(a,b,c){Y=new window.XMLHttpRequest;Y.open(c?"POST":"GET",a,!0);c?(Y.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),Y.send(c)):Y.send(null);Y.onreadystatechange=function(){4==Y.readyState&&(200==Y.status?b(Y.responseText):U("the server do not respond properly (ajax)"))}};function v(a){return document.getElementById(a)}function w(a,b){var c=document.createElement(a);c.setAttribute("id",b);document.body.appendChild(c);return c}function Z(a){m.i=e(a.clientX,a.clientY).c(m.d)}function H(a,b,c){var h="",g;for(g in b)var j=b instanceof Array?b[g]:g,h=h+('<option value="'+j+'"'+(j==c?"selected=selected":"")+">"+b[g]+"</option>");return y("select",h,a)}function y(a,b,c){return"<"+a+(c?" id="+c:"")+">"+(b?b:"")+"</"+a+">"}function z(a,b){return y("button",b?b:a,a)};var m,Y,K=[],n={metadata:{title:"An untitled social graph",authors:["Anonymous"],created:(new Date).toGMTString(),visibility:"private",license:"COPYRIGHT",alias:"untitled"},vertices:[]};window.onload=function(){var a=w("canvas","canvas"),b=window.innerHeight,c=window.innerWidth;m=a.getContext("2d");m.width=a.width=c;m.height=a.height=b;a.onclick=X;a.ondblclick=L;m.d=e(c/2,b/2);m.zoom=1;m.i=e(0,0);a=document.location.href.split("#");a instanceof Array&&(a=a[0]);a=a.split("?");a instanceof Array&&2==a.length&&(b=a[1],2<b.length&&/^\w+$/.test(b)&&S(t+"get?"+a[1],function(a){if((a=window.JSON.parse(a))&&a.metadata&&a.metadata instanceof Object&&a.vertices&&a.vertices instanceof Array){for(var b=0,c=a.vertices.length;b<c;b++)a.vertices[b]=new l(a.vertices[b]),a.vertices[b].position=e(a.vertices[b].position.x,a.vertices[b].position.y);n=Object(a)}else U("there is a vergence in the Force");u()}));u();V();window.onmousemove=Z;W()};</script>